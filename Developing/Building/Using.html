<!DOCTYPE html>
<!-- Page last generated 2018-05-28 11:10:35 +0000 -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configuring and building an seL4 project | seL4 docs</title>

    <!-- Our stylesheet and theme stylesheet.  Contains bootstrap. -->
    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <!-- Font awesome -->
    <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet">
    <!-- Pygments syntax highlighting  -->
    <link rel="stylesheet" href="/assets/css/highlighting/trac.css" type="text/css"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117737473-2"></script>
<script>
  if((window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
    window['ga-disable-UA-117737473-2'] = true;
  }
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117737473-2');
</script>
</head>

  <body class="container-fluid">

    

<header>
  <ul class="row menu">
    <li class="col-xs-12 col-md-2" >
            <a href="/">
              <img class="img-responsive" src="/logos/logo-text-white.svg" alt="seL4 logo" />
            </a>
    </li>
    <li class="col-xs-12 col-md-10 menu">
      <nav aria-label="Banner links">
        <h2><a href="/Documentation">Documentation</a></h2>
        <h2><a href="/GettingStarted">Getting Started</a></h2>
        <h2><a href="/Tutorials">Tutorials</a></h2>
        <h2><a href="https://research.csiro.au/tsblog">Blog</a></h2>
        <iframe title="DuckDuckGo search bar" src="https://duckduckgo.com/search.html?site=docs.sel4.systems&prefill=Search%20sel4.systems" style="overflow:hidden;margin-bottom:10px; padding:0;height:40px;float:right;border-width: 0px"></iframe>
      </nav>
    </li>
  </ul>
  <div class="clear"></div>
  <div class="breadcrumbs bootstrap hidden-sm-down">
  <nav class="sel-breadcrumb" aria-label="Breadcrumb" >
    <ol class=" list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">
      
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/">
              <span property="name"><b>seL4 Docs</b></span>
              <meta property="position" content="1" />
            </a>
        </li>
      
        

        

        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <a property="item" typeof="WebPage" href="/Developing/Building/">
              <span property="name"><b>System configuration and building</b></span>
              <meta property="position" content="2" />
            </a>
        </li>
      
        

        
          <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
            <span property="name">Configuring and building an seL4 project</span>
            <meta property="position" content="3" /></li>
          
    </ol>
  </nav>
  <nav class="sel-version" aria-label="Current Versions">
    <ol class="list-unstyled">
      <li class="list-unstyled text-right" style="margin-left:auto; padding:0rem 0rem;">
        Current versions:</li>
      <li class="list-unstyled text-right">
      <a href="/sel4_release/seL4_10.0.0"><b>seL4-10.0.0</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/sel4_release/seL4_9.0.0-mcs"><b>seL4-9.0.0-mcs</b></a></li>
      <li class="list-unstyled text-right">
      <a href="/camkes_release/CAmkES_3.5.0"><b>camkes-3.5.0</b></a></li>
    </ol>
  </nav>
  <div class='clear'></div>
</div>


</header>

    <main>
      <div class="row">
  <div class="hidden-xs col-sm-4 col-md-3 col-lg-2">
    <div class="sidebar">

    <h3>seL4</h3>
      <ul class="nav nav-sidebar">
  
        <li class="">
          <a class="" href="/GettingStarted.html">
            Getting Started
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Developing/Building/">
            CMake Build System
          </a>
        </li>
  
        <li class="">
          <a class="" href="/FrequentlyAskedQuestions.html">
            FAQ
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Hardware/">
            Hardware
          </a>
        </li>
  
        <li class="">
          <a class="" href="/CAmkES/">
            CAmkES
          </a>
        </li>
  
        <li class="">
          <a class="" href="/sel4_release/">
            Release Notes
          </a>
        </li>
  
        <li class="">
          <a class="" href="/ApiDoc.html">
            libsel4 API
          </a>
        </li>
  
        <li class="">
          <a class="" href="https://sel4.systems/Info/Docs/seL4-manual-latest.pdf">
            Current Manual
          </a>
        </li>
  
      </ul>

    <h3>Community</h3>
      <ul class="nav nav-sidebar">
  
        <li class="">
          <a class="" href="/Conduct.html">
            Code of Conduct
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Contributing.html">
            Contributing
          </a>
        </li>
  
        <li class="">
          <a class="" href="https://research.csiro.au/tsblog">
            Trustworthy Systems Blog
          </a>
        </li>
  
        <li class="">
          <a class="" href="/IRCChannel.html">
            IRC Channel
          </a>
        </li>
  
        <li class="">
          <a class="" href="/SuggestedProjects.html">
            Suggested projects
          </a>
        </li>
  
        <li class="">
          <a class="" href="/CommunityProjects.html">
            Community Projects
          </a>
        </li>
  
      </ul>

    <h3>Tutorials</h3>
      <ul class="nav nav-sidebar">
  
        <li class="">
          <a class="" href="/Tutorials/seL4_Tutorial_1.html">
            seL4 Tutorial 1
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/seL4_Tutorial_2.html">
            seL4 Tutorial 2
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/seL4_Tutorial_3.html">
            seL4 Tutorial 3
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/seL4_Tutorial_4.html">
            seL4 Tutorial 4
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/seL4_Timer_tutorial.html">
            seL4 Timer tutorial
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/seL4_RT_tutorial.html">
            seL4 MCS tutorial
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/CAmkES_Tutorial_0.html">
            CAmkES Tutorial 0
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/CAmkES_Tutorial_1.html">
            CAmkES Tutorial 1
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/CAmkES_Tutorial_2.html">
            CAmkES Tutorial 2
          </a>
        </li>
  
        <li class="">
          <a class="" href="/Tutorials/CAmkES_Timer_Tutorial.html">
            CAmkES Timer Tutorial
          </a>
        </li>
  
      </ul>
        
</div>


  </div>
  <div class="col-sm-8 col-md-9 col-lg-8 main">
    
    <div class="content">
      <h1 id="configuring-and-building-an-sel4-project">Configuring and building an seL4 project</h1>

<!--excerpt-->

<p>This page contains documentation for how to interact with and build a project that is using this build system.
If you are developing a project then should read the <a href="/Developing/Building/Incorporating">incorporating the build system</a> section.</p>

<!--excerpt-->

<h4 id="basic-build-initialisation">Basic build initialisation</h4>

<p>In the root directly of a seL4-based project, first create a separate build
directory for the output binaries, then initialize CMake:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir build
<span class="nb">cd </span>build
cmake <span class="nt">-DCROSS_COMPILER_PREFIX</span><span class="o">=</span>arm-linux-gnueabi- <span class="nt">-DCMAKE_TOOLCHAIN_FILE</span><span class="o">=</span>../kernel/gcc.cmake &lt;OTHER_COMMAND_LINE_OPTIONS_HERE&gt; <span class="nt">-G</span> Ninja ..
</code></pre></div></div>

<p>We also provide a shorthand wrapping script which hides all of these necessary
arguments other than the cross-compiler toolchain arguments, so you can instead
invoke cmake by proxy via our wrapping script, like this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>../init-build <span class="nt">-DCROSS_COMPILER_PREFIX</span><span class="o">=</span>arm-linux-gnueabi- &lt;COMMAND_LINE_OPTIONS_HERE&gt;
</code></pre></div></div>

<p>Breaking down what each component means</p>

<ul>
  <li><code class="highlighter-rouge">-D</code> means we are defining a variable in the form <code class="highlighter-rouge">X=Y</code></li>
  <li><code class="highlighter-rouge">CROSS_COMPILER_PREFIX</code> which is used to specify the toolchain to be used for
 cross-compilation. The toolchain cannot be changed after a build directory
 is initialised. For further details, please see the “Cross Compiling”
 section below.</li>
  <li><code class="highlighter-rouge">CMAKE_TOOLCHAIN_FILE</code> is variable understood by CMake and tells it to load the specified file as a
‘toolchain’ file. A toolchain file is able to setup the C compiler, linker etc that should be used. In this
case we assume a typical project layout with the seL4 kernel in a ‘kernel’ directory at the top level. The
‘<a href="https://github.com/seL4/seL4/blob/master/gcc.cmake">gcc.cmake</a>’ file in it sets up C compilers and linkers
using the previously supplied <code class="highlighter-rouge">CROSS_COMPILER_PREFIX</code></li>
  <li><code class="highlighter-rouge">-G Ninja</code> tells CMake that we want to generate Ninja build scripts as opposed to GNU Makefiles. Currently
only Ninja scripts are supported by parts of the kernel</li>
  <li><code class="highlighter-rouge">..</code> is the path to the top level <code class="highlighter-rouge">CMakeLists.txt</code> file that describes this project, generally this is
placed in the root directory so this parameter is typically <code class="highlighter-rouge">..</code>, but could be any path</li>
</ul>

<p>If all goes well you should now be able to build by doing</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ninja
</code></pre></div></div>

<p>And the resulting binaries will be placed in the <code class="highlighter-rouge">images/</code> subdirectory</p>

<h3 id="configuration">Configuration</h3>

<p>Many projects will have some degree of customisation available to them. Assuming a build directory that has been
initialised with CMake you can do either</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ccmake ..
</code></pre></div></div>

<p>for a ncurses based configuration editor or</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake-gui ..
</code></pre></div></div>

<p>for a graphical configuration editor.  In both invocations the path <code class="highlighter-rouge">..</code> should be the same path as was used in the original <code class="highlighter-rouge">cmake</code> invocation.</p>

<p>CMake itself has two different kinds of options:</p>

<ul>
  <li>Booleans: These are either <code class="highlighter-rouge">ON</code> or <code class="highlighter-rouge">OFF</code></li>
  <li>Strings: These can be set to any value, although they may be restricted to a set of values by whoever wrote the project.</li>
</ul>

<p>String options can have ‘hints’ given to them that they should only take on one of several fixed values. The
CMake configuration editors will respect these and provide a radio selection.</p>

<p>As you change configuration options the CMake scripts for the project are not continuously rerun. You can explicitly
rerun by telling it to ‘(c)onfigure’. This may result in additional options appearing in the configuration editor,
or some options being removed, depending on what their dependencies where. For example if there is option <code class="highlighter-rouge">A</code> that
is dependent on option <code class="highlighter-rouge">B</code> being true, and you change <code class="highlighter-rouge">B</code> to true, <code class="highlighter-rouge">A</code> will not show up until you (c)onfigure and
the CMake files are reprocessed.</p>

<p>When you are done changing options you can either ‘(g)enerate and exit’ or ‘(q)uit without generation’. If you
quit without generating then your changes will be discarded, you may do this at any time. You will only be
allowed to generate if you run (c)onfigure after doing any changes and CMake believes your configuration has
reached a fixed point.</p>

<p>After changing any options and generating call</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ninja
</code></pre></div></div>

<p>to rebuild the project.</p>

<h4 id="initial-configuration">Initial configuration:</h4>

<p>Many of our projects support multiple configurations, where the following broad
approaches are used to present simple options to the user:</p>

<ul>
  <li><strong>CMake cache scripts</strong>: These files can set any number of configuration
variables to an initial value. By combining one or more of these together you
can coherently configure a system</li>
  <li><strong>Meta configuration options</strong>:  Meta configuration options are normally
passed as initial <code class="highlighter-rouge">-DVAR=FOO</code> command line arguments to CMake and will be
programatically inspected by the projects CMake scripts to (re)configure the
system.</li>
</ul>

<h5 id="cmake-cache-scripts">CMake cache scripts:</h5>

<p>The project may provide multiple <code class="highlighter-rouge">.cmake</code> files which each contain the cache
settings necessary to configure a single feature or option. By combining
multiple <code class="highlighter-rouge">.cmake</code> files, you initialise the project in a certain way.
Cache script configurations are provided when initialising the build directory
by passing <code class="highlighter-rouge">-C &lt;file&gt;</code> to <code class="highlighter-rouge">cmake</code>. For example given some typical project structure,
one might invoke <code class="highlighter-rouge">cmake</code> or <code class="highlighter-rouge">init-build.sh</code> with several of these partial
cache scripts as arguments.</p>

<p>You can pass multiple <code class="highlighter-rouge">-C</code> options on the command line, although if they try and set the same cache variables only one of the
settings will actually get used. This means we might have two different configuration
files for <code class="highlighter-rouge">arm.cmake</code> and <code class="highlighter-rouge">x86.cmake</code>, and then two other files for <code class="highlighter-rouge">debug.cmake</code> and <code class="highlighter-rouge">release.cmake</code>. We could
now combine <code class="highlighter-rouge">arm.cmake</code> with either <code class="highlighter-rouge">debug.cmake</code> or <code class="highlighter-rouge">release.cmake</code>, similarly with <code class="highlighter-rouge">x86.cmake</code>. For example:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake <span class="nt">-C</span>../projects/awesome_project/configs/arm.cmake <span class="nt">-C</span>../projects/awesome_project/configs/debug.cmake <span class="nt">-DCROSS_COMPILER_PREFIX</span><span class="o">=</span>arm-linux-gnueabi- <span class="nt">-DCMAKE_TOOLCHAIN_FILE</span><span class="o">=</span>../kernel/gcc.cmake <span class="nt">-G</span> Ninja ..
</code></pre></div></div>

<p>Nothing stops you from trying to initialise with both <code class="highlighter-rouge">arm.cmake</code> and <code class="highlighter-rouge">x86.cmake</code>, but since they are probably
setting some of the same options only one will actually take effect. If the project has multiple configuration
files you should check which can be composed.</p>

<h5 id="meta-configuration-options">Meta configuration options:</h5>

<p>Not all projects follow this strictly but we have a set of top-level
meta-variables which, if they are used by a project, will have the same
behaviour:</p>

<ul>
  <li><code class="highlighter-rouge">-DPLATFORM=&lt;YOUR_PREFERENCE&gt;</code>: Selects the target system for the resulting
binaries. Valid values for this variable are the first value (preceding the
semicolon) on each line of the <code class="highlighter-rouge">config_choice</code> directive for each
architecture:
    <ul>
      <li>For ARM: <a href="https://github.com/seL4/seL4/blob/master/src/arch/arm/config.cmake#L21">List in source</a>.</li>
      <li>For X86: <a href="https://github.com/seL4/seL4/blob/master/src/arch/x86/config.cmake#L15">List in source</a>.</li>
      <li>For RISC-V: <a href="https://github.com/seL4/seL4/blob/master/src/arch/riscv/config.cmake#L15">List in source</a>.</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">-DRELEASE</code>: Set to <code class="highlighter-rouge">0</code> or <code class="highlighter-rouge">1</code>: Turning this off compiles a debug build.
Turning it on compiles the project without debugging features enabled.</li>
  <li><code class="highlighter-rouge">-DVERIFICATION</code>: Set to <code class="highlighter-rouge">0</code> or <code class="highlighter-rouge">1</code>: This is used to generate the version of
the seL4 kernel source which is <strong>VERIFIABLE</strong>. This does not produce a binary
for the <strong>verified</strong> kernel platform.</li>
  <li><code class="highlighter-rouge">-DSMP</code>: Set to <code class="highlighter-rouge">0</code> or <code class="highlighter-rouge">1</code>: Turns SMP (symmetric multiprocesing) support on or
off. By default it will enable support for up to 4 processors. To explicitly
set the max number of supported CPUs, try setting
<code class="highlighter-rouge">-DKernelMaxNumNodes=&lt;YOUR_PREFERENCE&gt;</code>.</li>
  <li><code class="highlighter-rouge">-DSIMULATION</code>: Set to <code class="highlighter-rouge">0</code> or <code class="highlighter-rouge">1</code>: This produces a build of the project which
 is suited for running in an emulator such as Qemu.</li>
</ul>

<p>seL4test and seL4bench follow this form.</p>

<h4 id="sel4test-example"><a href="https://github.com/seL4/sel4test">sel4test</a> example:</h4>

<p>Please see the <a href="../../seL4Test">main page on seL4test</a> for more information on how to configure
and build seL4test.</p>

<h3 id="cross-compiling">Cross compiling:</h3>

<p>Cross compilation refers to compiling a program for a target machine which is
different from the machine you’re building it on. When compiling low level
software you often find yourself needing to compile it on a machine which is
different from the machine it will eventually be executed on.</p>

<p>In order to cross-compile, you usually need a separate compiler which
specifically targets the foreign machine.</p>

<h4 id="for-arm-based-targets">For ARM-based targets:</h4>

<p>You must explicitly always pass in the command line argument <code class="highlighter-rouge">-DAARCH32</code> or
<code class="highlighter-rouge">-DAARCH64</code> when cross-compiling for an ARM-based chipset – <strong>or</strong> you can
make use of <code class="highlighter-rouge">-DCROSS_COMPILER_PREFIX</code>.</p>

<ul>
  <li><code class="highlighter-rouge">-DAARCH32</code>: Tells the build system that you are building for a 32-bit
ARM target. This will cause the build system to assume that you have a
cross compiler installed which targets a system with the triplet name
<code class="highlighter-rouge">arm-linux-gnueabi-</code>.</li>
  <li><code class="highlighter-rouge">-DAARCH32HF</code>: Tells the build system you’re building for a 64-bit ARM
target which has hardware floating point support. Assumes you have a cross-
compiler installed which targets <code class="highlighter-rouge">arm-linux-gnueabihf-</code>.</li>
  <li><code class="highlighter-rouge">-DAARCH64</code>: Tells the build system you’re building for a 64-bit ARM
target. Assumes you have a cross-compiler installed which targets
<code class="highlighter-rouge">aarch64-linux-gnu-</code>.</li>
</ul>

<p><strong>OR</strong> you can always just pass in <code class="highlighter-rouge">-DCROSS_COMPILER_PREFIX=&lt;TARGET_TRIPLET&gt;</code>
which can be used to explicitly set the target-triplet prefix of the
cross-compiler which you would prefer to use to compile your binaries.</p>

<h4 id="for-risc-v-based-targets">For RISC-V based targets:</h4>

<p>You must explicitly always pass in the command line argument <code class="highlighter-rouge">-DRISCV32</code> or
<code class="highlighter-rouge">-DRISCV64</code> when cross compiling for a RISC-V target – <strong>or</strong> you can make use
of <code class="highlighter-rouge">-DCROSS_COMPILER_PREFIX</code>.</p>

<ul>
  <li><code class="highlighter-rouge">-DRISCV32</code>: Tells the build system that you are building for a 32-bit RISC-V
target. This will cause the build system to assume that you have a cross-
compiler installed which targets a system with the triplet name
<code class="highlighter-rouge">riscv32-unknown-elf-</code>.</li>
  <li><code class="highlighter-rouge">-DRISCV64</code>: Tells the build system you’re building for a 64-bit RISC-V
target. Assumes you have a cross-compiler installed which targets
<code class="highlighter-rouge">riscv64-unknown-elf-</code>.</li>
</ul>

<p><strong>OR</strong> you can always just pass in <code class="highlighter-rouge">-DCROSS_COMPILER_PREFIX=&lt;TARGET_TRIPLET&gt;</code>
which can be used to explicitly set the target-triplet prefix of the
cross-compiler which you would prefer to use to compile your binaries.</p>

<h4 id="cmake_build_type">CMAKE_BUILD_TYPE</h4>

<p>The <code class="highlighter-rouge">CMAKE_BUILD_TYPE</code> option is an option that will appear in the CMake configuration editors that is not
defined by a project, but is rather defined by CMake itself. This option configures the kind of build to do;
release, debug, release with debug information, etc. Note that the seL4 kernel ignores this setting as due
to the way the kernel has to be built it side steps many of the CMake systems.</p>


    </div>
  </div>
</div>

    </main>
    

<footer class="site-footer">

  <h2 class="footer-heading">seL4 docs</h2>

  <div class="footer-col-wrapper">

    <div class="col-md-2">
      

<ul class="social-media-list">
  <li><a href="https://github.com/sel4"><i class="fab fa-github"></i> <span class="username">sel4</span></a></li><li><a href="https://github.com/sel4proj"><i class="fab fa-github"></i> <span class="username">sel4proj</span></a></li>
</ul>

    </div>

    <div class="col-md-8">
      <ul class="list-unstyled">
        <li>
          This site is for displaying seL4 related documentation.  Pull requests are welcome.
        </li>
        
          <li>
            Site last updated: Mon May 28 21:10:06 2018 +1000 e484a53
          </li>
          <li>
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
                Page last updated: Mon May 28 16:30:11 2018 +1000 595594e
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
              
            
          </li>
        
      </ul>
    </div>
    <div class="col-md-2">
      <a href="https://github.com/SEL4PROJ/docs/blob/master/Developing/Building/Using.md">View page on GitHub</a>
      <br />
      <a href="https://github.com/SEL4PROJ/docs/edit/master/Developing/Building/Using.md">Edit page on GitHub</a>
      <br />
      <a href="/sitemap">Sitemap</a>
    </div>

  </div>

</footer>
  </body>
</html>
