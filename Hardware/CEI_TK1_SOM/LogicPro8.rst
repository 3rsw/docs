= Using the Saleae Logic Pro 8 to debug a CAN bus =
== Introduction ==
This page is a quick write up of how we used a logic analyzer to help solve a message loss issue when using a CAN bus.  We had two TK1-SOMs connected together on a CAN bus.  One of them runs Linux natively and the other runs a seL4 CAmkES application that receives CAN frames and then prints them out.  We found that although the CAmkES application could correctly receive and reply to individual CAN frames, when frames were being received at the maximum rate of the bus the CAmkES application would only print out the first, last and occasionally a frame in the middle.  Read more about CAN [[https://en.wikipedia.org/wiki/CAN_bus|here]], and [[https://www.saleae.com/index|here]] is the Saleae Logic Pro 8 site. Information about the TK1-SOM daughter board that we use is [[https://bitbucket.csiro.au/projects/OH/repos/tk1som-can-daughterboard/browse|here]].

== Setup ==
Each of the TK1-SOMs have a daughter board with a MCP25625 CAN controller on them that can communicate with the processor over SPI.  When a controller receives a CAN message it notifies the processor by interrupting it over a GPIO line.  The processor then reads the CAN message out of the controller over SPI.  We can use the LogicPro8 to probe the CAN bus, the SPI bus and also the GPIO pin that the interrupt is received on to get a feel for what is going on.
